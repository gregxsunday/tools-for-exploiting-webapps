{% extends "layout.html" %}
{% block body %}

    <h2>Run a new CORS scan</h2>

    <div id="userInput">
            <input id="textInput" type="text" name="msg" placeholder="Message">
            <input id="buttonInput" type="submit" value="Send">
    </div>
    <div id="response">
    </div>
    <script>
        function sendDomain() {
            var rawText = $("#textInput").val();
            var xhttp = new XMLHttpRequest();

            xhttp.onreadystatechange = function () {
                $("#result").text("");
                if (this.readyState == 4 && this.status == 200) {
                    var response = '<p><span>Scan is running!</span></p>';
                    $("#response").append(response);
                } else if (this.readyState == 4 && this.status == 400) {
                    var response = '<p><span>Something went wrong! For now only example.com and google.com can be queried</span></p>';
                    $("#response").append(response);
                }
            }
            const data = new FormData();
            data.append("domain", rawText);
            xhttp.open("POST", "/run", true);
            xhttp.send(data);
        };

        $("#textInput").keypress(function (e) {
                if (e.which == 13) {
                    sendDomain();
                }
        });

        $("#buttonInput").click(function () {
                sendDomain();
        });
    </script>

{% endblock %}