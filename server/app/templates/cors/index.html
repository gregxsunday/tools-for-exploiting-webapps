{% extends "layout.html" %}
{% block body %}
    <div class="container">
        <div class="row">
            <h1>Run a new CORS scan</h1>
        </div>

        <label for="domain">Domain:</label>
        <input id="domain" type="text" name="msg" placeholder="Domain"><br>
        <label for="log_level">Log level:</label>
        <select id="log_level" name="log_level">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
        </select>
        <br>
        <label for="char_mode">Special character mode:</label>
        <select id="char_mode" name="char_mode">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
        </select>
        <br>
        <input id="buttonInput" type="submit" value="Send">
        
        <div id="response">
        </div>
    </div>
    <script>
        function sendDomain() {
            var domain = $("#domain").val();
            var log_level = $("#log_level").val();
            var char_mode = $("#char_mode").val();
            var xhttp = new XMLHttpRequest();

            xhttp.onreadystatechange = function () {
                $("#result").text("");
                if (this.readyState == 4 && this.status == 200) {
                    var response = '<p><span>Scan is running!</span></p>';
                    $("#response").append(response);
                } else if (this.readyState == 4 && this.status == 400) {
                    var response = '<p><span>Something went wrong!</span></p>';
                    $("#response").append(response);
                } else if (this.readyState == 4 && this.status == 403) {
                    var response = '<p><span>Wrong domain name!</span></p>';
                    $("#response").append(response);
                }
            }
            const data = new FormData();
            data.append("domain", domain);
            data.append("log_level", log_level);
            data.append("char_mode", char_mode);
            xhttp.open("POST", "/run", true);
            xhttp.send(data);
        };

        $("#textInput").keypress(function (e) {
                if (e.which == 13) {
                    sendDomain();
                }
        });

        $("#buttonInput").click(function () {
                sendDomain();
        });
    </script>

{% endblock %}