import sys
from subprocess import call
from flask import Blueprint, request, render_template, Response, flash, g, session, redirect, url_for, \
                  abort, jsonify

mod = Blueprint('cors', __name__)

@mod.route('/cors', methods=['GET'])
def index():
  return (render_template('cors/index.html'))

# Change method of calling a scan - sanitazing input and maybe import module?
@mod.route('/run', methods=['POST'])
def run():
    rawText = request.form.get('domain')
    # After creating correct validation, this if can be deleted
    if rawText == 'example.com' or rawText == 'wp.pl':
        with open("../test.txt", "w") as f:
            call(["python", "../CORS/AsynchronousCORSScanner/cors_scanner.py", f"-d {rawText}"])
        return Response(status=200)
    return Response(status=400)